<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ユメミる草原 - ラジオ体操参加</title>
<style>
:root{
  --bg:#f6f8fa;
  --card:#ffffff;
  --accent:#334155;
  --yume-pink:#f7d9ec;
  --yume-blue:#3d9aff;
  --yume-white:#ffffff;
  --bar-bg:#ff695c;
  --bar-fill:#ffffff;
}
html,body{
  height:100%;
  margin:0;
  font-family:system-ui,-apple-system,"Hiragino Kaku Gothic ProN",Meiryo,sans-serif;
  background:url('https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/home.png') center/cover no-repeat;
  color:var(--accent);
}
.page{display:none;width:100vw;height:100vh;}
.page.active{display:flex;align-items:center;justify-content:center;}
.card{
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(6px);
  padding:28px;
  border-radius:18px;
  box-shadow:0 6px 20px rgba(16,24,40,0.12);
  width:100%;
  max-width:720px;
  text-align:center;
  border:3px solid var(--yume-blue);
}
h1{
  font-weight:700;
  margin:0 0 10px;
  font-size:38px;
  letter-spacing:0.02em;
  color:#5aa7ff;
  text-shadow:0 0 6px #ffffffaa;
}
p.subtitle{margin:0 0 12px;color:#475569;font-weight:600;}
p.desc{margin:0 0 20px;color:#334155;}
.button-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}
.button-row img {
  width: 130px;
  height: 200px;
  object-fit: contain;
  cursor: pointer;
  flex: none;
  margin: 0 12px;
}
.time-bar-wrap{
  width:100%;
  height:16px;
  background:var(--bar-bg);
  border-radius:20px;
  margin-top:6px;
  margin-bottom:14px;
  overflow:hidden;
  border:2px solid #fff;
  position: relative;
}
.time-bar{
  height:100%;
  width:100%;       /* ← 右から左へ減るので初期100% */
  background:var(--bar-fill);
  position: absolute;
  right:0;
  top:0;
  transition: width 0.5s linear;
}
#remainingTime{font-size:17px; font-weight:700; margin-bottom:4px; color:#ffffff; text-shadow:0 0 4px #0008;}
.fullimage{width:100%;height:100%;object-fit:contain;background:black;}
.home-btn{
  position:absolute;
  bottom:20px;
  right:20px;
  padding:12px 20px;
  background:#f7d9ec;
  color:#333;
  border-radius:12px;
  font-size:18px;
  font-weight:700;
  box-shadow:0 3px 6px #0005;
}
#playerContainer{
  position:fixed;inset:0;
  display:none;align-items:center;justify-content:center;
  background:#000;z-index:9999
}
video{width:100%;height:100%;object-fit:contain;background:black;}
</style>
</head>
<body>

<!-- ホーム -->
<div id="home" class="page active">
  <div class="wrap">
    <div class="card">
      <h1>ユメミる草原</h1>
      <div class="button-row">
        <img src="https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/zukan.png" alt="図鑑" onclick="showPage('zukan')">
        <img src="https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/radio.png" id="joinBtnImg" alt="ラジオ体操参加">
        <img src="https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/howto.png" alt="遊び方" onclick="showPage('howto')">
      </div>
      <p class="subtitle">立ち入り可能時間 : 【Local Time】 <strong>06:00〜06:03</strong></p>
      <p class="desc">　中に入るとユメっ子と遭遇　→　運が良ければ寝顔が見れます　</p>
      <div id="remainingTime"></div>
      <div class="time-bar-wrap"><div id="timeBar" class="time-bar"></div></div>
      <input id="pw" type="password" placeholder="運営用パスワード ">
    </div>
  </div>
</div>

<!-- 図鑑 -->
<div id="zukan" class="page">
  <img src="https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/aaaa.jpg" class="fullimage">
  <button class="home-btn" onclick="showPage('home')">ホーム</button>
</div>

<!-- 遊び方 -->
<div id="howto" class="page">
  <img src="https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/イラスト11.png" class="fullimage">
  <button class="home-btn" onclick="showPage('home')">ホーム</button>
</div>

<!-- 動画再生 -->
<div id="playerContainer"></div>

<script>
/* ページ切替 */
function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

/* 設定 */
const config={
  videos:[
    {id:'v1',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/1o.mp4',weight:16},
    {id:'v2',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/1x.mp4',weight:2},
    {id:'v3',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/2o.mp4',weight:16},
    {id:'v4',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/2x.mp4',weight:1},
    {id:'v5',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/3o.mp4',weight:16},
    {id:'v6',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/3x.mp4',weight:1},
    {id:'v7',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/4o.mp4',weight:10},
    {id:'v8',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/4x.mp4',weight:1},
    {id:'v9',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/5o.mp4',weight:10},
    {id:'v10',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/5x.mp4',weight:1},
    {id:'v11',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/6o.mp4',weight:10},
    {id:'v12',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/6x.mp4',weight:1},
    {id:'v13',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/7x.mp4',weight:11},
    {id:'v14',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/8x.mp4',weight:2},
    {id:'v15',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/9x.mp4',weight:2},
  ],
  bypassPassword:'1122',
  allowedTimes:[{hour:6,startMinute:0,endMinute:3}]
};

/* JST */
function nowJST(){
  const d=new Date();
  return new Date(d.getTime()+d.getTimezoneOffset()*60000+9*3600*1000);
}

/* 許可時間判定 */
function isWithinAllowedWindow(){
  const j=nowJST();
  for(const t of config.allowedTimes){
    const s=new Date(j); s.setHours(t.hour,t.startMinute,0,0);
    const e=new Date(j); e.setHours(t.hour,t.endMinute,59,999);
    if(j>=s && j<=e) return true;
  }
  return false;
}

/* 次開始時間 */
function getNextStart(){
  const j=nowJST();
  let next=null;
  for(const t of config.allowedTimes){
    const s=new Date(j); s.setHours(t.hour,t.startMinute,0,0);
    if(s>j && (!next||s<next)) next=s;
  }
  if(!next){
    const t=config.allowedTimes[0];
    next=new Date(j.getTime()+24*3600*1000);
    next.setHours(t.hour,t.startMinute,0,0);
  }
  return next;
}

/* UI更新 */
function updateRemaining(){
  const j=nowJST();
  const pw=document.getElementById('pw').value===config.bypassPassword;
  const joinBtnImg=document.getElementById('joinBtnImg');
  const tDiv=document.getElementById('remainingTime');
  const bar=document.getElementById('timeBar');
  const allowed=isWithinAllowedWindow()||pw;

  joinBtnImg.style.opacity=allowed?1:0.45;
  joinBtnImg.style.pointerEvents=allowed?'auto':'none';

  /* 運営モード */
  if(pw){
    tDiv.textContent='運営モード - いつでも開始できます';
    bar.style.width='0%';   /* 右端固定なので100%満タン＝0% */
    return;
  }

  const next=getNextStart();

  /* 1日の経過 → バーは右→左 */
  const startToday=new Date(j); startToday.setHours(0,0,0,0);
  const totalDaySec=24*3600;
  const elapsedSec=(j-startToday)/1000;
  const percentDay = elapsedSec/totalDaySec*100;
  const invPercentDay=100-percentDay;

  /* 許可時間内 */
  if(isWithinAllowedWindow()){
    const t=config.allowedTimes[0];
    const start=new Date(j); start.setHours(t.hour,t.startMinute,0,0);
    const end=new Date(j);   end.setHours(t.hour,t.endMinute,59,999);

    const diff=(end-j)/1000;
    const min=Math.floor(diff/60);
    const sec=Math.floor(diff%60);
    tDiv.textContent=`開始可能時間内 : 残り ${min}分 ${sec}秒`;

    const totalSecWindow=(end-start)/1000;
    const elapsedWindow=(j-start)/1000;
    const percentWindow=elapsedWindow/totalSecWindow*100;
    const invPercentWindow=100-percentWindow;

    bar.style.width=`${invPercentWindow}%`;

  } else {   
/* 未開始 */ 
    const diff=(next-j)/1000; 
    const h=Math.floor(diff/3600); 
    const m=Math.floor((diff%3600)/60); 
    const s=Math.floor(diff%60); tDiv.textContent=`残り: ${h}時間 ${m}分 ${s}秒`;
    
    bar.style.width=${invPercentDay}%; /* 右→左 */ 
  } 
}


/* 重み付きランダム */
function weightedPick(list){
  const total=list.reduce((s,i)=>s+(i.weight||1),0);
  let r=Math.random()*total;
  for(const item of list){
    r-=(item.weight||1);
    if(r<=0) return item;
  }
  return list[list.length-1];
}

/* 動画再生 */
async function onJoin(){
  const pick=weightedPick(config.videos);
  const container=document.getElementById('playerContainer');
  container.style.display='flex';
  container.innerHTML='';
  const vid=document.createElement('video');
  vid.src=pick.url;
  vid.playsInline=true;
  vid.autoplay=true;
  vid.controls=false;
  container.appendChild(vid);

  vid.addEventListener('loadeddata',async()=>{
    try{await vid.play();}catch(e){}
    try{if(container.requestFullscreen) await container.requestFullscreen({navigationUI:'hide'});}catch(e){}
  });

  vid.addEventListener('ended',async()=>{
    try{if(document.fullscreenElement) await document.exitFullscreen();}catch(e){}
    vid.remove();
    const endText=document.createElement('div');
    endText.textContent='END';
    Object.assign(endText.style,{
      color:'#fff',
      fontSize:'48px',
      fontWeight:'700',
      position:'absolute',
      top:'45%',
      left:'50%',
      transform:'translate(-50%,-50%)'
    });
    container.appendChild(endText);
  });
}

document.getElementById('joinBtnImg').addEventListener('click',onJoin);
setInterval(updateRemaining,1000);
updateRemaining();
</script>
</body>
</html>

