<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ユメミる草原 - ゆめかわプレイヤーUI</title>
<style>
  :root{--bg:#f6f8fa;--card:#ffffff;--accent:#334155}
  html,body{
    height:100%;margin:0;
    font-family:system-ui,-apple-system,"Hiragino Kaku Gothic ProN",Meiryo,sans-serif;
    background:url('https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/home.png') center/cover no-repeat;
    color:var(--accent);
    -webkit-font-smoothing:antialiased;
  }

  /* 全ページラッパー（ページ切替対応） */
  .page { display:none; width:100vw; height:100vh; }
  .page.active { display:flex; align-items:center; justify-content:center; }

  /* プレイヤーカード */
  .player {
    width:380px;
    background: rgba(255,255,255,0.18);
    border-radius:20px;
    padding:16px;
    box-shadow: 0 8px 30px rgba(16,24,40,0.12);
    position:relative;
    backdrop-filter: blur(6px);
  }

  /* イラストを入れるフレーム（背景画像をここで指定） */
  .frame {
    width:100%;
    height:220px;
    border-radius:14px;
    border: 4px solid rgba(255,255,255,0.8);
    overflow:hidden;
    position:relative;
    background: url('https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/home.png') center/cover no-repeat;
  }

  /* タイトルを画像の上に置く */
  .frame .title {
    position:absolute;
    left:50%; top:12px;
    transform:translateX(-50%);
    color:#ffffff;
    font-weight:700;
    font-size:20px;
    text-shadow:0 6px 18px rgba(0,0,0,0.35);
    padding:6px 14px;
    border-radius:12px;
    background: linear-gradient(90deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
    backdrop-filter: blur(2px);
  }

  /* 画像（もし img を差し替えたい場合に使う） */
  .frame img {
    width:100%;
    height:100%;
    object-fit:contain;
    display:block;
  }

  /* 下部の残り時間表示とバー */
  .time-row {
    margin-top:12px;
    display:flex;
    align-items:center;
    gap:8px;
    color:#fff;
    font-size:13px;
    justify-content:space-between;
  }
  .time-left { font-weight:700; color:#fff; text-shadow:0 2px 6px rgba(0,0,0,0.4); }

  /* スライダー／バー周り */
  .progress-wrap{
    margin-top:8px;
    position:relative;
    height:14px;
    border-radius:10px;
    background:rgba(255,255,255,0.2);
    overflow:hidden;
  }
  .progress-fill{
    position:absolute;
    left:0; top:0; bottom:0;
    width:0%;
    background: linear-gradient(90deg,#ffffff,#fff9e6);
    transition:width 0.12s linear;
  }
  /* 見た目スライダー（透明にして代わりに progress-fill を使う） */
  input[type=range].hidden-range{
    -webkit-appearance:none;
    appearance:none;
    width:100%;
    height:14px;
    background:transparent;
    position:relative;
  }
  input[type=range].hidden-range::-webkit-slider-thumb{
    -webkit-appearance:none;
    width:14px;height:14px;border-radius:50%;
    background:#fff;border:3px solid rgba(0,0,0,0.08);
    box-shadow:0 4px 10px rgba(0,0,0,0.18);
    cursor:pointer;
  }

  /* コントロールボタン */
  .controls{
    display:flex;
    justify-content:center;
    align-items:center;
    gap:22px;
    margin-top:16px;
  }
  .btn{
    width:56px;height:56px;border-radius:50%;
    background:linear-gradient(180deg,#ffd6ef,#ff7acb);
    border:3px solid rgba(255,255,255,0.8);
    display:flex;align-items:center;justify-content:center;
    cursor:pointer;box-shadow: 0 8px 20px rgba(255,120,200,0.15);
  }
  .btn img{ width:28px;height:28px; object-fit:contain; }

  /* 下の補助テキスト（説明文）をカード外に配置 */
  .explain {
    margin-top:18px;
    width:380px;
    color:#08203a;
    background: rgba(255,255,255,0.65);
    padding:10px 14px;
    border-radius:12px;
    text-align:left;
    font-size:13px;
    box-shadow:0 6px 18px rgba(16,24,40,0.06);
  }

  /* 図鑑/遊び方ページのスタイル */
  .fullpage{
    width:100vw;height:100vh;position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:999;
  }
  .fullpage .content{
    width:90%;max-width:920px;height:80%;background:#fff;border-radius:14px;overflow:auto;position:relative;padding:18px;
  }
  .fullpage img{ width:100%; height:100%; object-fit:contain; display:block; }

  .home-btn{
    position:absolute;
    bottom:16px; right:16px;
    padding:10px 14px;background:#ff77c7;color:#fff;border-radius:12px;border:0;cursor:pointer;
  }

  /* レスポンシブ */
  @media (max-width:420px){
    .player, .explain { width:92vw; }
    .frame{ height:180px; }
  }
</style>
</head>
<body>

<!-- HOME: プレイヤーUI -->
<div id="home" class="page active">
  <div class="player" role="application" aria-label="プレイヤーUI">
    <!-- イラスト枠（背景は home.png） -->
    <div class="frame" id="frame">
      <div class="title" id="frameTitle">ユメの草原</div>
      <!-- optional <img id="frameImg" src=""> を入れても差し替え可 -->
      <img id="frameImg" src="" alt="" style="display:none;">
    </div>

    <!-- 残り時間 & バー -->
    <div class="time-row">
      <div class="time-left" id="remainingPreview">24:00:00</div>
      <div style="color:rgba(0,0,0,0.6);font-size:13px;" id="previewLabel">残り時間</div>
    </div>

    <div class="progress-wrap" aria-hidden="false">
      <div class="progress-fill" id="progressFill"></div>
      <!-- スライダーは 0〜86400 (秒) を扱う：値が小さい＝残りが少ない -->
      <input id="previewSlider" class="hidden-range" type="range" min="0" max="86400" value="86400" aria-label="残り時間スライダー">
    </div>

    <!-- コントロール（左 = 図鑑 / 中央 = 開始 / 右 = 遊び方） -->
    <div class="controls" role="group" aria-label="操作ボタン">
      <div class="btn" id="zukanBtn" title="図鑑（←）">
        <img id="leftIcon" src="" alt="左アイコン">
      </div>

      <div class="btn" id="startBtn" title="ゲーム開始（中央）">
        <img id="playIcon" src="" alt="再生アイコン">
      </div>

      <div class="btn" id="howBtn" title="遊び方（→）">
        <img id="rightIcon" src="" alt="右アイコン">
      </div>
    </div>
  </div>
</div>

<!-- 説明文（カードの外、下に配置） -->
<div style="display:flex; justify-content:center; margin-top:14px;">
  <div class="explain" id="mainExplain">
    ラジオ体操は毎朝06:02〜06:05に押せます。運営用パスワードで時間外に参加可能。
  </div>
</div>

<!-- 図鑑ページ（フルスクリーン） -->
<div id="zukan" class="page" aria-hidden="true">
  <div class="fullpage" id="zukanPage" style="display:none;">
    <div class="content">
      <img src="https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/aaaa.jpg" alt="図鑑">
      <button class="home-btn" onclick="closeFull('zukan')">ホーム</button>
    </div>
  </div>
</div>

<!-- 遊び方ページ（フルスクリーン） -->
<div id="howto" class="page" aria-hidden="true">
  <div class="fullpage" id="howPage" style="display:none;">
    <div class="content">
      <img src="https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/イラスト11.png" alt="遊び方">
      <button class="home-btn" onclick="closeFull('howto')">ホーム</button>
    </div>
  </div>
</div>

<!-- 動画再生枠（既存の挙動をそのまま利用） -->
<div id="playerContainer"></div>

<script>
/* ==========================
   --- カスタム可能な画像 ---
   ここでアイコンやフレームに使う画像を指定できます。
   空文字のままだと表示しない（代わりに背景 home.png を使う）。
   ========================== */
const ASSETS = {
  frameImg: '', // 枠内に別のimgを入れたい場合のURL（空なら background home.png を使う）
  leftIcon: '', // 左矢印（図鑑）PNG URL
  playIcon: '', // 中央開始ボタンPNG URL
  rightIcon: '' // 右矢印（遊び方）PNG URL
};

// アイコンを差し替え（空文字は無視）
if(ASSETS.leftIcon) document.getElementById('leftIcon').src = ASSETS.leftIcon;
if(ASSETS.playIcon) document.getElementById('playIcon').src = ASSETS.playIcon;
if(ASSETS.rightIcon) document.getElementById('rightIcon').src = ASSETS.rightIcon;
if(ASSETS.frameImg){
  const fi = document.getElementById('frameImg');
  fi.src = ASSETS.frameImg;
  fi.style.display = 'block';
  // hide background image when using frameImg
  document.getElementById('frame').style.background = 'none';
}

/* --------------------------
   ページ切り替え（図鑑・遊び方）
   -------------------------- */
function openFull(id){
  if(id === 'zukan'){
    document.getElementById('zukanPage').style.display = 'flex';
  }else if(id === 'howto'){
    document.getElementById('howPage').style.display = 'flex';
  }
  // hide main home area (keeps page active state)
  document.getElementById('home').classList.remove('active');
}
function closeFull(id){
  if(id === 'zukan'){
    document.getElementById('zukanPage').style.display = 'none';
  }else if(id === 'howto'){
    document.getElementById('howPage').style.display = 'none';
  }
  document.getElementById('home').classList.add('active');
}

/* ==========================
   残り時間スライダー（24時間 = 86400秒）
   - スライダーの値: 0..86400
   - value が小さいほど残りが少ない。0秒＝残りゼロ（白線が最大）
   - progress = 1 - (value/86400) を使って白の進捗幅を決定
   ========================== */
const slider = document.getElementById('previewSlider');
const remainingPreview = document.getElementById('remainingPreview');
const progressFill = document.getElementById('progressFill');

function secToHHMMSS(sec){
  sec = Number(sec);
  if(sec < 0) sec = 0;
  const h = Math.floor(sec / 3600);
  const m = Math.floor((sec % 3600) / 60);
  const s = sec % 60;
  return `${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

function updatePreviewUI(val){
  // val is 0..86400 (seconds remaining)
  remainingPreview.textContent = secToHHMMSS(val);
  const pct = 1 - (val / 86400); // 0..1, 0 => no fill, 1 => full fill
  progressFill.style.width = `${Math.round(pct * 100)}%`;
}

// init
updatePreviewUI(Number(slider.value));

// hook slider
slider.addEventListener('input', (e)=> {
  updatePreviewUI(Number(e.target.value));
});

/* ==========================
   元の動画再生ロジックはそのまま使う（onJoin）
   startBtn を押すと onJoin() が呼ばれるように繋げる
   ========================== */

/* ---------- 元の設定（そのまま貼っています） ---------- */
const config={videos:[
  {id:'v1',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/1o.mp4',weight:16},
  {id:'v2',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/1x.mp4',weight:2},
  {id:'v3',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/2o.mp4',weight:16},
  {id:'v4',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/2x.mp4',weight:1},
  {id:'v5',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/3o.mp4',weight:16},
  {id:'v6',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/3x.mp4',weight:1},
  {id:'v7',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/4o.mp4',weight:10},
  {id:'v8',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/4x.mp4',weight:1},
  {id:'v9',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/5o.mp4',weight:10},
  {id:'v10',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/5x.mp4',weight:1},
  {id:'v11',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/6o.mp4',weight:10},
  {id:'v12',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/6x.mp4',weight:1},
  {id:'v13',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/7x.mp4',weight:11},
  {id:'v14',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/8x.mp4',weight:2},
  {id:'v15',url:'https://raw.githubusercontent.com/yumemiru28000/yumemirusougenn/main/9x.mp4',weight:2},
],
bypassPassword:'2855',
allowedTimes:[{hour:6,startMinute:2,endMinute:5}]};

function nowJST(){const d=new Date();return new Date(d.getTime()+d.getTimezoneOffset()*60000+9*3600*1000);}
function weightedPick(list){const total=list.reduce((s,i)=>s+(i.weight||1),0);let r=Math.random()*total;for(const item of list){r-=(item.weight||1);if(r<=0)return item;}return list[list.length-1];}

/* 元の UI 要素への参照を残しておく（説明文は外に出しています） */
const joinBtn = document.createElement('button'); // dummy placeholder (既存コードが参照するため)
joinBtn.id = 'joinBtn'; // ただし本来の join ボタンは startBtn が担う

// 既存の運営用パスワード入力要素（画面に残すため DOM 上に作る）
const pwInput = document.createElement('input');
pwInput.type = 'password';
pwInput.id = 'pw';
pwInput.placeholder = '運営用';
pwInput.style.display = 'none'; // 今回 UI をシンプルにするため非表示。ただし存在はする。
document.body.appendChild(pwInput);

/* 既存コードが参照する remainingTime 用要素を移植（画面下の explain の下に表示される形式） */
const remainingTimeDiv = document.createElement('div');
remainingTimeDiv.id = 'remainingTime';
remainingTimeDiv.style.display = 'none'; // 既存のボタン時間表示は不要にしたため非表示だが要素はある
document.body.appendChild(remainingTimeDiv);

/* --------------------------
   onJoin: 元の動画再生処理（ほぼそのまま）
   startBtn を押すとこれが呼ばれる
   -------------------------- */
async function onJoin(){
  const pick = weightedPick(config.videos);
  if(!pick){ alert('動画が登録されていません'); return; }

  const container = document.getElementById('playerContainer');
  container.style.display = 'flex'; container.innerHTML = '';
  container.style.background = '#000';
  container.style.position = 'fixed';
  container.style.inset = '0';
  container.style.zIndex = '9999';
  container.style.alignItems = 'center';
  container.style.justifyContent = 'center';

  const vid = document.createElement('video');
  vid.src = pick.url;
  vid.playsInline = true;
  vid.autoplay = true;
  vid.controls = false;
  vid.loop = false;
  container.appendChild(vid);

  vid.addEventListener('loadeddata', async () => {
    try{ await vid.play(); } catch(e){ console.warn(e); }
    try{ if(container.requestFullscreen) await container.requestFullscreen({navigationUI:'hide'}); } catch(e){ console.warn(e); }
  });

  const blockKeys = (ev) => {
    const blocked=[' ','Spacebar','k','K','MediaPlayPause','MediaStop','Escape'];
    if(blocked.includes(ev.key) || blocked.includes(ev.code)){ ev.preventDefault(); }
  };
  document.addEventListener('keydown', blockKeys, {capture:true});
  container.addEventListener('contextmenu', (ev)=>ev.preventDefault());
  container.addEventListener('click', (ev)=>ev.preventDefault());

  vid.addEventListener('ended', async () => {
    try{ if(document.fullscreenElement) await document.exitFullscreen(); } catch(e){ console.warn(e); }
    vid.remove();

    const endText = document.createElement('div');
    endText.textContent = 'END';
    Object.assign(endText.style, { color:'#fff', fontSize:'48px', fontWeight:'700', position:'absolute', top:'45%', left:'50%', transform:'translate(-50%,-50%)' });
    container.appendChild(endText);

    const subText = document.createElement('div');
    subText.textContent = 'いってらっしゃい';
    Object.assign(subText.style, { color:'#fff', fontSize:'24px', position:'absolute', top:'60%', left:'50%', transform:'translate(-50%,-50%)' });
    container.appendChild(subText);
  });
}

/* ================
   UI イベントバインド
   ================ */
document.getElementById('zukanBtn').addEventListener('click', ()=> openFull('zukan'));
document.getElementById('howBtn').addEventListener('click', ()=> openFull('howto'));
document.getElementById('startBtn').addEventListener('click', ()=> {
  // ゲーム開始ボタン(中央) は既存の onJoin を呼ぶ
  onJoin();
});

/* init: 既存の updateButtonState 等を必要に応じて呼び出せるよう最低限用意 */
(function initOriginally(){
  // 既存の機能（運営用パスワード等）は元コードを残していますが、
  // 今回はUIを差し替えているため画面表示関連は上の新UIに任せます。
  // もし pwInput を visible にして本来の挙動を使いたい場合は表示を切り替えてください。
})();
</script>
</body>
</html>
